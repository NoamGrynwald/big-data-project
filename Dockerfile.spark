# ---------------------------------------------------------------------------
# Spark driver image that runs fraud_detection_spark.py
# ---------------------------------------------------------------------------
FROM bitnami/spark:3.4

# ----- 1. Root for package install and script fix --------------------------
USER 0
RUN install_packages netcat-openbsd curl dos2unix

WORKDIR /app
COPY scripts/ ./scripts/

# Fix CRLF line endings *while still root*,
# then make scripts executable and hand ownership to the non-root user.
RUN dos2unix /app/scripts/wait-for-kafka-and-spark.sh \
 && chmod +x /app/scripts/wait-for-kafka-and-spark.sh /app/scripts/*.py \
 && chown -R 1001:1001 /app/scripts

# ----- 2. Drop privileges ---------------------------------------------------
USER 1001

